<div class="timer-container">
  <div class="timer-header">
    <h2>{{ getModeLabel() }}</h2>
    <div class="session-counter">
      Completed Sessions: {{ workSessionsCompleted() }}
    </div>
  </div>

  <!-- Mode Selector -->
  <div class="mode-selector">
    <button
      class="mode-btn"
      [class.active]="currentMode() === 'work'"
      (click)="onModeChange('work')"
    >
      Work
    </button>
    <button
      class="mode-btn"
      [class.active]="currentMode() === 'shortBreak'"
      (click)="onModeChange('shortBreak')"
    >
      Short Break
    </button>
    <button
      class="mode-btn"
      [class.active]="currentMode() === 'longBreak'"
      (click)="onModeChange('longBreak')"
    >
      Long Break
    </button>
  </div>

  <!-- Circular Progress Timer -->
  <div class="timer-circle-container">
    <svg class="timer-svg" viewBox="0 0 300 300">
      <!-- Background circle -->
      <circle
        class="timer-circle-bg"
        cx="150"
        cy="150"
        [attr.r]="radius"
        fill="none"
        stroke="#e5e7eb"
        stroke-width="12"
      />
      <!-- Progress circle -->
      <circle
        class="timer-circle-progress"
        cx="150"
        cy="150"
        [attr.r]="radius"
        fill="none"
        [attr.stroke]="getModeColor()"
        stroke-width="12"
        stroke-linecap="round"
        [attr.stroke-dasharray]="circumference"
        [attr.stroke-dashoffset]="strokeDashoffset()"
      />
    </svg>
    <div class="timer-text">
      <div class="time-display">{{ formattedTime() }}</div>
    </div>
  </div>

  <!-- Task Selector -->
  @if (currentMode() === 'work') {
    <div class="task-selector">
      <label for="task-select">Working on:</label>
      <select
        id="task-select"
        [value]="selectedTaskId() || ''"
        (change)="onTaskChange($event)"
      >
        <option value="">No specific task</option>
        @for (task of tasks(); track task._id) {
          <option [value]="task._id">{{ task.title }}</option>
        }
      </select>
    </div>
  }

  <!-- Control Buttons -->
  <div class="timer-controls">
    @if (!isRunning()) {
      <button class="control-btn start-btn" (click)="onStart()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M8 5v14l11-7z"/>
        </svg>
        Start
      </button>
    } @else {
      <button class="control-btn pause-btn" (click)="onPause()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
        </svg>
        Pause
      </button>
    }
    <button class="control-btn reset-btn" (click)="onReset()">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
        <path d="M21 3v5h-5"/>
        <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
      </svg>
      Reset
    </button>
    <button class="control-btn skip-btn" (click)="onSkip()">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
        <path d="M6 4l12 8-12 8V4zm12 0v16h2V4h-2z"/>
      </svg>
      Skip
    </button>

    <!-- Volume Control -->
    <div class="volume-control" 
         (mouseenter)="onVolumeMouseEnter()" 
         (mouseleave)="onVolumeMouseLeave()">
      <button class="volume-btn control-btn" 
              (click)="toggleMute()"
              [attr.aria-label]="soundService.isMuted() ? 'Unmute' : 'Mute'">
        @if (getVolumeIcon() === 'muted') {
          <!-- Muted icon -->
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
            <line x1="23" y1="9" x2="17" y2="15"></line>
            <line x1="17" y1="9" x2="23" y2="15"></line>
          </svg>
        } @else if (getVolumeIcon() === 'low') {
          <!-- Low volume icon -->
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
            <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
          </svg>
        } @else if (getVolumeIcon() === 'medium') {
          <!-- Medium volume icon -->
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
            <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
          </svg>
        } @else {
          <!-- High volume icon -->
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
            <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
          </svg>
        }
      </button>
      <div class="volume-slider-container" [class.visible]="showVolumeSlider()">
        <input 
          type="range" 
          min="0" 
          max="100" 
          [value]="soundService.volume()" 
          (input)="onVolumeChange($event)"
          class="volume-slider"
          aria-label="Volume"
        />
        <span class="volume-label">{{ soundService.volume() }}%</span>
      </div>
    </div>
  </div>
</div>

